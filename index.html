
<!DOCTYPE html>
<html>
    <head>
        <title>Sauna</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div id="content">
            <h1>Saunatonttu</h1>
            <div id="status-table">
                <div class="status-container">
                    <span>Stove</span>
                    <span id="status">Initializing...</span>
                </div>
            </div>
            <div id="button-container">
                <button id="btn-turn" disabled>Start</button>
            </div>
        </div>

    </body>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btnTurn = document.getElementById('btn-turn');
        const kiuasState = document.getElementById("status");

        btnTurn.addEventListener("click", async () => {
            await turnServo();
        });

        async function getState() {
            try {
                const res = await fetch("/api/status", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json; charset=UTF-8"
                    }
                });

                const data = await res.json();
                console.log("data:", data);

                kiuasState.classList.remove("success-text");

                switch (data.status) {
                    case -1:
                        kiuasState.innerText = "Shutting down";
                        btnTurn.disabled = true;
                        break;
                    case 0:
                        kiuasState.innerText = "Not ready";
                        btnTurn.disabled = true;
                        break;
                    case 1:
                        kiuasState.innerText = "Ready";
                        btnTurn.disabled = false;
                        break;
                    case 2:
                        kiuasState.innerText = "Turning...";
                        btnTurn.disabled = true;
                        break;
                    case 3:
                        kiuasState.innerText = "Activated";
                        kiuasState.classList.add("success-text");
                        btnTurn.disabled = false;
                        break;
                    default:
                        kiuasState.innerText = "Unknown";
                        btnTurn.disabled = true;
                }
            } catch (error) {
                console.error("Error fetching status:", error);
                kiuasState.innerText = "Error";
                btnTurn.disabled = true;
            }
        }

        async function turnServo() {
            try {
                const res = await fetch("/api/turn", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json; charset=UTF-8"
                    }
                });

                if (!res.ok) {
                    console.log("Turn failed, status:", res.status);
                    return;
                }

                btnTurn.disabled = true;
                setTimeout(getState, 500);
            } catch (error) {
                console.error("Error turning sauna:", error);
            }
        }

        function getSecret() {
            return document.getElementById("secret").value;
        }

        getState();
        setInterval(getState, 3000);
    });
</script>


</html>